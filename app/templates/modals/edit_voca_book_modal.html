<div class="modal fade" id="editVocaBookModal" tabindex="-1" aria-labelledby="editVocaBookModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editVocaBookModalLabel">단어장 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editVocaBookForm">
          <input type="hidden" name="id" id="editVocaBookId">
          <div class="mb-3">
            <label for="editBookNm" class="form-label">단어장명 *</label>
            <input type="text" class="form-control" id="editBookNm" name="book_nm" required>
          </div>
          <div class="mb-3">
            <label for="editLanguage" class="form-label">언어 *</label>
            <select class="form-select" id="editLanguage" name="language" required>
              <option value="영어">영어</option>
              <option value="일본어">일본어</option>
              <option value="중국어">중국어</option>
              <option value="한국어">한국어</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="editSource" class="form-label">출처 *</label>
            <input type="text" class="form-control" id="editSource" name="source" required>
          </div>
          <div class="mb-3">
            <label for="editCategory" class="form-label">카테고리</label>
            <select class="form-select" id="editCategory" name="category">
              <option value="">선택하세요</option>
              <option value="수능">수능</option>
              <option value="토익">토익</option>
              <option value="토플">토플</option>
              <option value="일상">일상</option>
              <option value="비즈니스">비즈니스</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="editWordCount" class="form-label">단어 수</label>
            <input type="number" class="form-control" id="editWordCount" name="word_count" min="0">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <button type="submit" class="btn btn-primary" form="editVocaBookForm">저장</button>
      </div>
    </div>
  </div>
</div>

<script>
// 수정 모달에서 데이터 로드
document.getElementById('editVocaBookModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const id = button.getAttribute('data-id');
    
    // 현재 카드에서 데이터 가져오기
    const card = button.closest('.card');
    const title = card.querySelector('.card-title').textContent.trim();
    const cardText = card.querySelector('.card-text').textContent.trim();
    
    // 간단한 파싱 (실제로는 더 정교한 방법 필요)
    const languageMatch = cardText.match(/언어: ([^\n]+)/);
    const sourceMatch = cardText.match(/출처: ([^\n]+)/);
    const categoryMatch = cardText.match(/카테고리: ([^\n]+)/);
    const wordCountMatch = cardText.match(/단어 수: (\d+)/);
    
    // 폼에 데이터 설정
    document.getElementById('editVocaBookId').value = id;
    document.getElementById('editBookNm').value = title;
    if (languageMatch) document.getElementById('editLanguage').value = languageMatch[1].trim();
    if (sourceMatch) document.getElementById('editSource').value = sourceMatch[1].trim();
    if (categoryMatch) document.getElementById('editCategory').value = categoryMatch[1].trim();
    if (wordCountMatch) document.getElementById('editWordCount').value = wordCountMatch[1];
});

// 수정 폼 제출
document.getElementById('editVocaBookForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const id = document.getElementById('editVocaBookId').value;
    const data = {
        book_nm: document.getElementById('editBookNm').value,
        language: document.getElementById('editLanguage').value,
        source: document.getElementById('editSource').value,
        category: document.getElementById('editCategory').value,
        word_count: parseInt(document.getElementById('editWordCount').value) || null
    };
    
    try {
        const response = await fetch(`/voca/api/voca/${id}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            location.reload();
        } else {
            alert('수정에 실패했습니다.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('수정 중 오류가 발생했습니다.');
    }
});
</script> 